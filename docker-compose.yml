services:
  # User Service Microservice
  user-service:
    build: ./user-service
    container_name: mobitrak-user-service
    ports:
      - "${USER_SERVICE_PORT}:5001"
    environment:
      - PORT=5001
      - MONGO_URI=${MONGO_URI}
      - GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
      - JWT_SECRET=${JWT_SECRET}
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASS=${SMTP_PASS}
      - EMAIL_FROM=${EMAIL_FROM}
      # Cloudinary Configuration
      - CLOUDINARY_CLOUD_NAME=${CLOUDINARY_CLOUD_NAME}
      - CLOUDINARY_API_KEY=${CLOUDINARY_API_KEY}
      - CLOUDINARY_API_SECRET=${CLOUDINARY_API_SECRET}
      # OCR.space API Key for DL extraction
      - OCR_SPACE_API_KEY=${OCR_SPACE_API_KEY_USER}
      # AI Extraction Configuration (OpenRouter) for DL extraction
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY_USER}
      - AI_API_URL=${AI_API_URL}
      - AI_MODEL=${AI_MODEL}
      - FRONTEND_URL=${FRONTEND_URL:-http://localhost:5173}
    networks:
      - mobitrak-network

  # Vehicle Service Microservice
  vehicle-service:
    build: ./vehicle-service
    container_name: mobitrak-vehicle-service
    ports:
      - "${VEHICLE_SERVICE_PORT}:5002"
    environment:
      - PORT=5002
      - MONGO_URI=${MONGO_URI}
      - JWT_SECRET=${JWT_SECRET}
      - CLOUDINARY_CLOUD_NAME=${CLOUDINARY_CLOUD_NAME}
      - CLOUDINARY_API_KEY=${CLOUDINARY_API_KEY}
      - CLOUDINARY_API_SECRET=${CLOUDINARY_API_SECRET}
      - OCR_SPACE_API_KEY=${OCR_SPACE_API_KEY_VEHICLE}
      # AI Extraction Configuration (OpenRouter)
      - AI_API_KEY=${OPENROUTER_API_KEY_VEHICLE}
      - AI_API_URL=${AI_API_URL}
      - AI_MODEL=${AI_MODEL}
    networks:
      - mobitrak-network

  # Driver Management Service Microservice
  driver-management-service:
    build: ./driver-management-service
    container_name: mobitrak-driver-management-service
    ports:
      - "${DRIVER_SERVICE_PORT}:5003"
    environment:
      - PORT=5003
      - MONGO_URI=${MONGO_URI}
      - JWT_SECRET=${JWT_SECRET}
      - NODE_ENV=${NODE_ENV:-development}
      - SMTP_HOST=${SMTP_HOST}
      - SMTP_PORT=${SMTP_PORT}
      - SMTP_USER=${SMTP_USER}
      - SMTP_PASS=${SMTP_PASS}
      - EMAIL_FROM=${EMAIL_FROM}
      - USER_SERVICE_URL=http://user-service:5001
    depends_on:
      - user-service
    networks:
      - mobitrak-network

  # Trip Service Microservice
  trip-service:
    build: ./trip-service
    container_name: mobitrak-trip-service
    ports:
      - "${TRIP_SERVICE_PORT}:5004"
    environment:
      - PORT=5004
      - MONGO_URI=${MONGO_URI}
      - JWT_SECRET=${JWT_SECRET}
      - MAPBOX_ACCESS_TOKEN=${MAPBOX_ACCESS_TOKEN}
      - FRONTEND_URL=${FRONTEND_URL:-http://localhost:5173}
      - USER_SERVICE_URL=http://user-service:5001
      - NOTIFICATION_SERVICE_URL=http://user-service:5001
    depends_on:
      - user-service
    networks:
      - mobitrak-network

networks:
  mobitrak-network:
    driver: bridge
